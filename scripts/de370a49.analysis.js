d3.json("http://nagaretetter-server.herokuapp.com/songs/ranking.json",function(a,b){var c=1e3,d=400,e=b.ranking,f=e.map(function(a){return a.title}),g=e.map(function(a){return a.total}),h=d3.select(".analysis-main").append("svg").attr("width",c).attr("height",d),i=h.append("g").attr("transform","translate(40, 20)");i.append("g").attr("class","x axis").attr("transform","translate(0, 150)"),i.append("g").attr("class","y axis");var j=d3.scale.ordinal().rangeRoundBands([0,c-100],.1).domain(f),k=d3.scale.linear().range([150,0]).domain([0,d3.max(g)]),l=i.selectAll(".bar").data(e);l.enter().append("rect"),l.exit().remove(),l.attr("class","bar").attr("width",j.rangeBand()).attr("height",function(a){return 150-k(a.total)}).attr("x",function(a){return j(a.title)}).attr("y",function(a){return k(a.total)}).attr({"data-container":"body","data-toggle":"popover","data-placement":"right"}).attr("data-content",function(a){return a.title+" / "+a.artist}).attr("data-title",function(a,b){return b+1+"位 : "+a.total+"回ナガレテッター"});var m=d3.svg.axis().scale(j).orient("bottom"),n=d3.svg.axis().scale(k).orient("left").tickFormat(d3.format(".0"));d3.select(".x.axis").call(m).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-65)"}),d3.select(".y.axis").call(n),$(".bar").popover({trigger:"hover"}),$(".loading").hide()}),$(function(){$.get("http://nagaretetter-server.herokuapp.com/songs/ranking_range.json",function(a){$(".rankingRange").text(a.ranking_range.range)})});